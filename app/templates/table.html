<!DOCTYPE html>
<html lang="en">
  <head>
    <title>cve list</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
<style>
  body{
    padding: 1ch;
  }
  table{
    border-spacing: 0;
    width: 100%;
  }
  th{
    background: lightgrey;
  }
  tr, td, th{
    border: 1px solid gray;
    gap: 1rem;
    padding: 1rem;
  }
  h1{
    display: flex;
    justify-content: center;
    align-items: center;
  }

  div {
    display: flex;
    align-items: center;
    gap: 3ch;
    padding-block: 0.5ch;
  }
</style>
  <body>
    <h1>CVE LIST</h1>
    <h3>TOTAL RECORDs: {{total}}</h3>
    <h2>Results: {{search_total}}</h2>
    <form action="/" method="GET">
      <div>
        <div>
          <label for="id">cve id:</label>
          <input type="text" id="id" name="id" value="{{inputs.id}}">
        </div>
        <div>
          <label for="year">year:</label>
          <input type="text" id="year" name="year" value="{{inputs.year}}">
        </div>
        <div>

          <label for="lastmodified">lastmodified:</label>
          <input type="number" id="lastmodified" name="lastmodified" value="{{inputs.lastmodified}}">
        </div>
      </div>
      <div>
      <div>

        <label for="lt">lesser than score:</label>
        <input type="number" step="any" id="lt" name="lt" value="{{inputs.lt}}">
      </div>
      <div>

        <label for="gt">greater than score:</label>
        <input type="number" step="any" id="gt" name="gt" value="{{inputs.gt}}">
      </div>
      <div>

        <label for="limit">per page:</label>
        <select name="limit" id="limit">
        <option value=10 {%if inputs.limit == 10 %} selected="selected" {% endif %}>10</option>
          <option value=50 {%if inputs.limit == 50 %} selected="selected" {% endif %}>50</option>
          <option value=100 {%if inputs.limit == 100 %} selected="selected" {% endif %}>100</option>
        </select>
      </div>
      </div>

        <br>
        <br>
        <input type="submit" value="Submit">
        <br>
        <br>

   <!-- Pagination controls -->
      <h3>{{ page * inputs.limit }} of {{ search_total }}</h3>
      {% if page > 1 %}
          <a href="{{ url_for('index', page=page-1) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Previous</a>
      {% else %}
          <span style="color: grey;">Previous</span>
      {% endif %}
      <a href="{{ url_for('index', page=page) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{page}}</a>
      <a href="{{ url_for('index', page=page+1) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{page+1}}</a>
      <a href="{{ url_for('index', page=page+2) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{page+2}}</a>
      <a href="{{ url_for('index', page=page+3) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{page+3}}</a>
      <a href="{{ url_for('index', page=page+1) }}{% for key, value in request.args.items() %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Next</a>


    </form>
    <table>
      <tr>
      <th>CVE ID</th>
      <th>IDENTIFIER</th>
      <th>PUBLISHED DATE</th>
      <th>LAST MODIFIED</th>
      <th>STATUS</th>
      <th>BASE SCORE</th>
    </tr>
      {% for data in datas %}
        <tr>
          <td><a href="/cve/lists/id/{{ data.id }}">{{ data.id }}</td>
          <td>{{ data.sourceIdentifier }}</td>
          <td>{{ data.published.split('T')[0].replace('-', '/') }}</td>
          <td>{{ data.lastModified.split('T')[0].replace('-', '/') }}</td>
          <td>{{ data.vulnStatus }}</td>
          {% if "cvssMetricV2" in data.metrics.keys()  %}
            <td>{{data.metrics.cvssMetricV2[0].cvssData.baseScore}}</td>
          {% endif %}
          {% if "cvssMetricV3" in data.metrics.keys()  %}
            <td>{{data.metrics.cvssMetricV3[0].cvssData.baseScore}}</td>
          {% endif %}
        </tr>
      {% endfor %}
    </table>
  </body>
</html>
